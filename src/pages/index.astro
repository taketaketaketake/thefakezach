---
import "../styles/global.css";
import Modal from "../components/Modal.astro";
import ProjectsSection from "../components/ProjectsSection.astro";
import BlogSection from "../components/BlogSection.astro";
import { projects as allProjects } from "../data/projects";

// Filter out projects hidden from homepage
const hiddenFromHomepage = [
  "Fix My Furnace",
  "Detroit Small Business Map",
  "Bags of Laundry"
];
const projects = allProjects.filter(p => !hiddenFromHomepage.includes(p.title));

const zachary = {
  name: "Zachary Lewis",
  username: "thefakezach",
  avatarPhoto: "/profile-photo.jpg",
  joinDate: "Building from Detroit, MI",
  about: `TL;DR — I like to build things.

---

I'm currently fixated on building a management OS and cognition layer for multi-agent systems.`,
  contact: {
    twitter: "#",
    github: "#",
    linkedin: "#",
    email: "mailto:zach at takedetroit.com"
  },
  projects
};
---

<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <!-- Primary Meta Tags -->
    <title>{zachary.name} | Designer & Developer</title>
    <meta name="title" content="{zachary.name} | Designer & Developer" />
    <meta name="description" content="Detroit-based developer and designer creating innovative web solutions. Building AI voice agents, business maps, and digital experiences from Motor City." />
    <meta name="keywords" content="Detroit developer, Michigan web developer, AI voice agents, business mapping, software engineer, web design, Motor City tech" />
    <meta name="author" content="{zachary.name}" />
    <meta name="robots" content="index, follow" />
    <meta name="language" content="English" />
    <meta name="theme-color" content="#ec4899" />
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://thefakezach.com/" />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://thefakezach.com/" />
    <meta property="og:title" content="{zachary.name} | Designer & Developer" />
    <meta property="og:description" content="Detroit-based developer and designer creating innovative web solutions. Building AI voice agents, business maps, and digital experiences from Motor City." />
    <meta property="og:image" content="https://thefakezach.com/og-image.jpg" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:image:alt" content="Zachary Lewis - Detroit Developer & Designer" />
    <meta property="og:site_name" content="{zachary.name}" />
    <meta property="og:locale" content="en_US" />
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="https://thefakezach.com/" />
    <meta name="twitter:title" content="{zachary.name} | Designer & Developer" />
    <meta name="twitter:description" content="Detroit-based developer and designer creating innovative web solutions. Building AI voice agents, business maps, and digital experiences from Motor City." />
    <meta name="twitter:image" content="https://thefakezach.com/og-image.jpg" />
    <meta name="twitter:image:alt" content="Zachary Lewis - Detroit Developer & Designer" />
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    
    <!-- Preload Critical Resources -->
    
    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "{zachary.name}",
      "url": "https://thefakezach.com",
      "image": "https://thefakezach.com/og-image.jpg",
      "jobTitle": "Developer & Designer",
      "worksFor": {
        "@type": "Organization",
        "name": "Freelance"
      },
      "address": {
        "@type": "PostalAddress",
        "addressLocality": "Detroit",
        "addressRegion": "MI",
        "addressCountry": "US"
      },
      "alumniOf": "University",
      "knowsAbout": ["Web Development", "AI Voice Agents", "Business Mapping", "Software Engineering", "Product Design"],
      "description": "Detroit-based developer and designer creating innovative web solutions.",
      "sameAs": [
        "https://github.com/thefakezach",
        "https://linkedin.com/in/thefakezach"
      ]
    }
    </script>
  </head>

  <body class="bg-zinc-950 text-zinc-50 font-sans min-h-screen flex flex-col">
    <!-- Hero Header -->
    <header class="relative overflow-hidden">
      <!-- Gradient Banner -->
      <div class="h-48 bg-gradient-to-br from-pink-600 via-purple-600 to-indigo-700"></div>

      <!-- Profile Card (Overlaps Banner) -->
      <div class="relative -mt-20 px-4 sm:px-6 max-w-5xl mx-auto">
        <div class="bg-zinc-900/80 backdrop-blur-sm rounded-2xl p-6 shadow-2xl border border-zinc-800">
          <div class="flex flex-col sm:flex-row items-center sm:items-end gap-5">
            <!-- Avatar -->
            <div class="w-24 h-24 sm:w-32 sm:h-32 rounded-full bg-zinc-800 border-4 border-zinc-950 shadow-xl flex-shrink-0 overflow-hidden">
              <img 
                src={zachary.avatarPhoto} 
                alt={`${zachary.name} profile photo`}
                class="w-full h-full object-cover"
                loading="eager"
              />
            </div>

            <!-- Name & Info -->
            <div class="flex-1 text-center sm:text-left">
              <h1 class="text-2xl sm:text-3xl font-bold text-white">{zachary.name}</h1>
              <p class="text-pink-400 text-lg font-medium" role="complementary">@{zachary.username}</p>
              <p class="text-sm text-zinc-400 mt-1">{zachary.joinDate}</p>
            </div>

          </div>
        </div>
      </div>
    </header>

    <!-- Tab Navigation -->
    <nav class="sticky top-0 z-10 bg-zinc-950/95 backdrop-blur-sm border-b border-zinc-800">
      <div class="max-w-5xl mx-auto px-4 sm:px-6">
        <div class="flex justify-center gap-1">
          <button
            class="tab-button px-6 py-4 text-sm font-medium text-zinc-400 hover:text-white transition-colors relative active"
            data-tab="0"
            aria-label="About tab"
          >
            About
            <span class="tab-indicator absolute bottom-0 left-0 right-0 h-0.5 bg-pink-500 transform transition-transform"></span>
          </button>
          <button
            class="tab-button px-6 py-4 text-sm font-medium text-zinc-400 hover:text-white transition-colors relative"
            data-tab="1"
            aria-label="Projects tab"
          >
            Projects
            <span class="tab-indicator absolute bottom-0 left-0 right-0 h-0.5 bg-pink-500 transform scale-x-0 transition-transform"></span>
          </button>
          <button
            class="tab-button px-6 py-4 text-sm font-medium text-zinc-400 hover:text-white transition-colors relative"
            data-tab="2"
            aria-label="Blog tab"
          >
            Blog
            <span class="tab-indicator absolute bottom-0 left-0 right-0 h-0.5 bg-pink-500 transform scale-x-0 transition-transform"></span>
          </button>
        </div>
      </div>
    </nav>

    <!-- Swipeable Container -->
    <div class="swipe-wrapper overflow-hidden">
      <div class="swipe-container flex transition-transform duration-300 ease-out" style="transform: translateX(0%)">

        <!-- Panel 1: About -->
        <div class="swipe-panel flex-shrink-0 w-full">
          <main class="max-w-5xl mx-auto px-4 sm:px-6 py-10">
            <div class="bg-zinc-900/50 backdrop-blur border border-zinc-800 rounded-2xl p-6">
              <h2 class="text-2xl font-bold text-white mb-4">About</h2>
              <div class="prose prose-invert max-w-none text-zinc-300 text-base md:text-lg leading-relaxed">
                {zachary.about.split("\n").map(line =>
                  line.trim() && <p class="mb-3">{line}</p>
                )}
              </div>
            </div>
          </main>
        </div>

        <!-- Panel 2: Projects -->
        <div class="swipe-panel flex-shrink-0 w-full">
          <main class="max-w-5xl mx-auto px-4 sm:px-6 py-10">
            <ProjectsSection projects={zachary.projects} />
          </main>
        </div>

        <!-- Panel 3: Blog -->
        <div class="swipe-panel flex-shrink-0 w-full">
          <main class="max-w-5xl mx-auto px-4 sm:px-6 py-10">
            <BlogSection />
          </main>
        </div>

      </div>
    </div>

    <!-- Footer -->
    <footer class="mt-auto border-t border-zinc-800 py-8 text-center text-xs text-zinc-500">
      <p>© {new Date().getFullYear()} {zachary.name}. All Rights Reserved.</p>
    </footer>

    <!-- Modals -->
    {zachary.projects.map(project => (
      <Modal project={project} />
    ))}

    <!-- Modal Script (Unchanged) -->
    <script define:vars={{ projects: zachary.projects }}>
      for (const project of projects) {
        const slug = project.title.toLowerCase().replace(/ /g, "-");
        const openButton = document.getElementById(`open-${slug}`);
        const closeButton = document.getElementById(`close-${slug}`);
        const modal = document.getElementById(`modal-${slug}`);

        if (!openButton || !modal) continue;

        openButton.addEventListener("click", () => {
          modal.classList.remove("hidden");
          modal.classList.add("flex");
          modal.setAttribute("aria-hidden", "false");
          document.body.style.overflow = "hidden";
        });

        if (closeButton) {
          closeButton.addEventListener("click", () => {
            modal.classList.add("hidden");
            modal.classList.remove("flex");
            modal.setAttribute("aria-hidden", "true");
            document.body.style.overflow = "";
          });
        }

        modal.addEventListener("click", (e) => {
          if (e.target === modal) {
            modal.classList.add("hidden");
            modal.classList.remove("flex");
            modal.setAttribute("aria-hidden", "true");
            document.body.style.overflow = "";
          }
        });
      }
    </script>

    <!-- Swipe Functionality Script -->
    <script>
      let currentTab = 0; // Start with About (index 0)
      const container = document.querySelector('.swipe-container');
      const tabButtons = document.querySelectorAll('.tab-button');
      const totalTabs = 3;

      let touchStartX = 0;
      let touchEndX = 0;
      let isDragging = false;
      let startX = 0;
      let currentTranslate = 0;
      let prevTranslate = 0;

      // Update active tab and position
      function switchToTab(index) {
        if (index < 0 || index >= totalTabs) return;

        currentTab = index;
        const offset = -index * 100;
        container.style.transform = `translateX(${offset}%)`;

        // Update tab button states
        tabButtons.forEach((btn, i) => {
          if (i === index) {
            btn.classList.add('active');
            btn.classList.remove('text-zinc-400');
            btn.classList.add('text-white');
            btn.querySelector('.tab-indicator').style.transform = 'scaleX(1)';
          } else {
            btn.classList.remove('active');
            btn.classList.add('text-zinc-400');
            btn.classList.remove('text-white');
            btn.querySelector('.tab-indicator').style.transform = 'scaleX(0)';
          }
        });
      }

      // Tab button clicks
      tabButtons.forEach((button, index) => {
        button.addEventListener('click', () => {
          switchToTab(index);
        });
      });

      // Touch events for mobile swipe
      const wrapper = document.querySelector('.swipe-wrapper');

      wrapper.addEventListener('touchstart', (e) => {
        // Don't start drag if touching form elements
        if (e.target.matches('input, textarea, button, select') || 
            e.target.closest('form')) {
          return;
        }
        
        touchStartX = e.touches[0].clientX;
        isDragging = true;
        container.style.transition = 'none';
      });

      wrapper.addEventListener('touchmove', (e) => {
        if (!isDragging) return;
        
        // Don't swipe if touching form elements
        if (e.target.matches('input, textarea, button, select') || 
            e.target.closest('form')) {
          return;
        }

        touchEndX = e.touches[0].clientX;
        const diff = touchEndX - touchStartX;
        const maxTranslate = 0;
        const minTranslate = -(totalTabs - 1) * 100;
        const baseTranslate = -currentTab * 100;
        const movePercent = (diff / window.innerWidth) * 100;

        let newTranslate = baseTranslate + movePercent;
        newTranslate = Math.max(minTranslate, Math.min(maxTranslate, newTranslate));

        container.style.transform = `translateX(${newTranslate}%)`;
      });

      wrapper.addEventListener('touchend', () => {
        if (!isDragging) return;

        isDragging = false;
        container.style.transition = 'transform 0.3s ease-out';

        const diff = touchEndX - touchStartX;
        const threshold = 50; // minimum swipe distance

        if (Math.abs(diff) > threshold) {
          if (diff > 0 && currentTab > 0) {
            // Swipe right - go to previous tab
            switchToTab(currentTab - 1);
          } else if (diff < 0 && currentTab < totalTabs - 1) {
            // Swipe left - go to next tab
            switchToTab(currentTab + 1);
          } else {
            // Not enough distance, snap back
            switchToTab(currentTab);
          }
        } else {
          // Not enough distance, snap back
          switchToTab(currentTab);
        }

        touchStartX = 0;
        touchEndX = 0;
      });

      // Mouse drag for desktop
      wrapper.addEventListener('mousedown', (e) => {
        isDragging = true;
        startX = e.clientX;
        container.style.transition = 'none';
        wrapper.style.cursor = 'grabbing';
      });

      wrapper.addEventListener('mousemove', (e) => {
        if (!isDragging) return;

        e.preventDefault();
        const currentX = e.clientX;
        const diff = currentX - startX;
        const maxTranslate = 0;
        const minTranslate = -(totalTabs - 1) * 100;
        const baseTranslate = -currentTab * 100;
        const movePercent = (diff / window.innerWidth) * 100;

        let newTranslate = baseTranslate + movePercent;
        newTranslate = Math.max(minTranslate, Math.min(maxTranslate, newTranslate));

        container.style.transform = `translateX(${newTranslate}%)`;
      });

      wrapper.addEventListener('mouseup', (e) => {
        if (!isDragging) return;

        isDragging = false;
        container.style.transition = 'transform 0.3s ease-out';
        wrapper.style.cursor = 'grab';

        const diff = e.clientX - startX;
        const threshold = 50;

        if (Math.abs(diff) > threshold) {
          if (diff > 0 && currentTab > 0) {
            switchToTab(currentTab - 1);
          } else if (diff < 0 && currentTab < totalTabs - 1) {
            switchToTab(currentTab + 1);
          } else {
            switchToTab(currentTab);
          }
        } else {
          switchToTab(currentTab);
        }
      });

      wrapper.addEventListener('mouseleave', () => {
        if (isDragging) {
          isDragging = false;
          container.style.transition = 'transform 0.3s ease-out';
          wrapper.style.cursor = 'grab';
          switchToTab(currentTab);
        }
      });

      // Keyboard navigation (arrow keys)
      document.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowLeft' && currentTab > 0) {
          switchToTab(currentTab - 1);
        } else if (e.key === 'ArrowRight' && currentTab < totalTabs - 1) {
          switchToTab(currentTab + 1);
        }
      });

      // Initialize
      wrapper.style.cursor = 'grab';
      switchToTab(currentTab);
    </script>

    <style>
      .tab-button.active {
        color: white;
      }

      .swipe-wrapper {
        min-height: 60vh;
        touch-action: pan-y; /* Allow vertical scrolling within panels */
      }

      .swipe-wrapper form,
      .swipe-wrapper input,
      .swipe-wrapper textarea {
        touch-action: auto; /* Allow normal touch behavior for form elements */
      }

      .swipe-container {
        will-change: transform;
      }

      .swipe-panel {
        min-height: 60vh;
      }
    </style>
  </body>
</html>